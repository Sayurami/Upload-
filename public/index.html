<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸ”¥ Gojo Photo Gallery</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #111; color: #fff; text-align: center; }
  input, textarea, button { margin: 5px 0; padding: 8px; width: 100%; max-width: 300px; }
  button { cursor: pointer; }
  #uploadDiv { display: none; margin-top: 20px; }
  .gallery { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 20px; justify-content: center; }
  .card { background: #222; border-radius: 8px; padding: 10px; width: 220px; text-align: center; }
  .card img { width: 100%; height: 150px; object-fit: cover; border-radius: 5px; cursor: pointer; }
  .card button { margin: 5px; padding: 5px 10px; border: none; border-radius: 6px; background: #ff4c00; color: #fff; cursor: pointer; }
</style>
</head>
<body>

<h1>ðŸ”¥ Gojo Photo Gallery ðŸ”¥</h1>

<div id="loginDiv">
  <input type="text" id="username" placeholder="Admin Username"><br>
  <input type="password" id="password" placeholder="Password"><br>
  <button onclick="login()">Login</button>
</div>

<div id="uploadDiv">
  <input type="file" id="fileInput"><br>
  <input type="text" id="nameInput" placeholder="Photo Name"><br>
  <textarea id="descInput" placeholder="Description or Links"></textarea><br>
  <button onclick="uploadFile()">Upload</button>
</div>

<div class="gallery" id="gallery"></div>

<script>
let token = "";

// Admin login
async function login() {
  const username = document.getElementById('username').value;
  const password = document.getElementById('password').value;
  const res = await fetch('/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, password })
  });
  const data = await res.json();
  if(data.token){
    token = data.token;
    alert('Login successful!');
    document.getElementById('loginDiv').style.display = 'none';
    document.getElementById('uploadDiv').style.display = 'block';
  } else {
    alert(data.error || 'Login failed');
  }
}

// Upload
async function uploadFile() {
  const file = document.getElementById('fileInput').files[0];
  const name = document.getElementById('nameInput').value;
  const description = document.getElementById('descInput').value;
  if(!file) return alert('Select a file!');
  const formData = new FormData();
  formData.append('photo', file);
  formData.append('name', name);
  formData.append('description', description);

  const res = await fetch('/upload', {
    method: 'POST',
    headers: { 'Authorization': 'Bearer ' + token },
    body: formData
  });
  const data = await res.json();
  if(data.success){
    alert('Upload successful!');
    loadGallery();
  } else {
    alert(data.error || 'Upload failed');
  }
}

// Delete
async function deletePhoto(fileName) {
  if(!confirm('Are you sure you want to delete this photo?')) return;
  const res = await fetch('/uploads/' + fileName, {
    method: 'DELETE',
    headers: { 'Authorization': 'Bearer ' + token }
  });
  const data = await res.json();
  if(data.success) loadGallery();
  else alert('Delete failed');
}

// Load gallery
async function loadGallery() {
  const res = await fetch('/uploads/');
  const items = await res.json();
  const gallery = document.getElementById('gallery');
  gallery.innerHTML = '';
  items.forEach(item => {
    const card = document.createElement('div');
    card.className = 'card';
    if(item.file.match(/\.(jpg|jpeg|png|gif)$/i)){
      card.innerHTML = `
        <img src="/uploads/${item.file}" onclick="window.open('/uploads/${item.file}', '_blank')" />
        <h4>${item.name}</h4>
        <p>${item.description}</p>
        ${token ? `<button onclick="deletePhoto('${item.file}')">Delete</button>` : ''}
        <button onclick="downloadPhoto('/uploads/${item.file}')">Download</button>
      `;
    } else {
      card.innerHTML = `
        <p><strong>${item.name}</strong></p>
        <p>${item.description}</p>
        <a href="/uploads/${item.file}" target="_blank">Download</a>
        ${token ? `<button onclick="deletePhoto('${item.file}')">Delete</button>` : ''}
      `;
    }
    gallery.appendChild(card);
  });
}

function downloadPhoto(url){
  const link = document.createElement('a');
  link.href = url;
  link.download = url.split('/').pop();
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

loadGallery();
</script>

</body>
</html>
